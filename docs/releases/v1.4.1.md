# CyberChef MCP Server v1.4.1 Release Notes

**Release Date:** 2025-12-14
**Release Type:** Security Patch

## Overview

v1.4.1 is a critical security patch release that addresses 11 vulnerabilities identified through GitHub Code Scanning (CodeQL analysis). This release focuses exclusively on security hardening with no functional changes to the MCP API.

## Security Fixes

### Critical Severity (1)

#### Insecure Cryptographic Randomness (CWE-330)
- **File:** `src/core/vendor/gost/gostRandom.mjs:119`
- **Issue:** Math.random() used as fallback for cryptographic operations
- **Fix:** Replaced with Node.js crypto.randomBytes() with proper error handling
- **Impact:** Prevents predictable cryptographic keys that could be brute-forced

### High Severity (7)

#### Regular Expression Denial of Service - ReDoS (CWE-1333)

All 7 vulnerabilities involved user-controlled regex patterns without validation:

| Operation | File | Line |
|-----------|------|------|
| RAKE | `src/core/operations/RAKE.mjs` | 58-59 |
| Filter | `src/core/operations/Filter.mjs` | 59 |
| FindReplace | `src/core/operations/FindReplace.mjs` | 79 |
| Register | `src/core/operations/Register.mjs` | 70 |
| Subsection | `src/core/operations/Subsection.mjs` | 98 |
| RegularExpression | `src/core/operations/RegularExpression.mjs` | 158 |

**Fix:** Created new `SafeRegex.mjs` security module with:
- Pattern length validation (10,000 char max)
- Nested quantifier detection
- Timeout-based backtracking detection (100ms default)
- XRegExp-specific flag support

### Low Severity (3) - Not Fixed

Non-cryptographic Math.random() usage in:
- `Numberwang.mjs` - Trivia game random selection
- `RandomizeColourPalette.mjs` - Color palette shuffling
- `LoremIpsum.mjs` - Placeholder text generation

These are acceptable for non-security contexts.

### Documented (1) - Web UI Only

Arbitrary code execution in `src/web/waiters/OutputWaiter.mjs:373` affects web UI only, not MCP server. Documented for future architectural enhancement.

## New Security Module

### SafeRegex.mjs

New utility module at `src/core/lib/SafeRegex.mjs` providing:

```javascript
import { createSafeRegex, validatePattern, isSafePattern, SafeRegexError } from './lib/SafeRegex.mjs';

// Create validated regex with timeout protection
const regex = createSafeRegex(userPattern, flags, { timeout: 100 });

// Validate pattern before use
const { isValid, error } = validatePattern(userPattern);

// Quick safety check
if (isSafePattern(userPattern)) { ... }
```

**Features:**
- Pattern length limits
- Nested quantifier detection (`(a+)+`, `(a*)*`, etc.)
- Timeout-based catastrophic backtracking detection
- XRegExp flag compatibility
- Detailed error messages

## Testing

- **Unit Tests:** 1,716 operation tests passing
- **Node API Tests:** 217 tests passing
- **Total:** 1,933 tests (100% pass rate)
- **ESLint:** 0 errors, 0 warnings
- **Manual Testing:** ReDoS patterns correctly rejected

## Files Changed

### New Files
- `src/core/lib/SafeRegex.mjs` (149 lines)

### Modified Files
- `package.json` - Version bump
- `src/node/mcp-server.mjs` - Version bump
- `src/core/vendor/gost/gostRandom.mjs` - Crypto fix
- `src/core/operations/RAKE.mjs` - SafeRegex integration
- `src/core/operations/Filter.mjs` - SafeRegex integration
- `src/core/operations/FindReplace.mjs` - SafeRegex integration
- `src/core/operations/Register.mjs` - SafeRegex integration
- `src/core/operations/Subsection.mjs` - SafeRegex integration
- `src/core/operations/RegularExpression.mjs` - SafeRegex integration
- `README.md` - Security documentation
- `CHANGELOG.md` - Release documentation
- `SECURITY_FIX_REPORT.md` - Detailed technical report
- `SECURITY_FIXES_SUMMARY.md` - Quick reference

## Upgrade Instructions

### Docker (Recommended)

```bash
# Pull latest image
docker pull ghcr.io/doublegate/cyberchef-mcp:v1.4.1

# Or use latest tag
docker pull ghcr.io/doublegate/cyberchef-mcp:latest
```

### Local Installation

```bash
git pull origin master
npm install
npx grunt configTests
```

## Compatibility

- **Node.js:** 22.x (recommended), 20.x (supported)
- **MCP Protocol:** Full backward compatibility
- **API:** No breaking changes
- **Operations:** All 465 tools unchanged

## Security Recommendations

1. **Upgrade immediately** - Critical cryptographic fix
2. **Review regex inputs** - SafeRegex now validates patterns
3. **Monitor for ReDoS** - Large/complex patterns may be rejected
4. **Check GOST operations** - Now using secure RNG

## Contributors

- Security fixes and SafeRegex module by doublegate
- Based on GCHQ CyberChef

## Links

- [Full Changelog](../CHANGELOG.md)
- [Security Policy](../SECURITY.md)
- [Security Fix Report](../SECURITY_FIX_REPORT.md)
- [Documentation](../docs/)
